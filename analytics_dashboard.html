<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoryCore Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }

        .header .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .metric-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-unit {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-left: 5px;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .trend-arrow {
            margin-right: 5px;
            font-size: 1.2em;
        }

        .trend-up { color: #27ae60; }
        .trend-down { color: #e74c3c; }
        .trend-stable { color: #f39c12; }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-healthy { background-color: #27ae60; }
        .status-warning { background-color: #f39c12; }
        .status-critical { background-color: #e74c3c; }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .system-health {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .health-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            color: #c0392b;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>üöÄ StoryCore Analytics Dashboard</h1>
            <p class="subtitle">Real-time monitoring and performance analytics for Video Engine</p>
        </div>

        <div id="loading" class="loading">
            <h3>Loading analytics data...</h3>
            <p>Initializing dashboard components</p>
        </div>

        <div id="dashboard-content" style="display: none;">
            <!-- Key Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>üé¨ Performance</h3>
                    <div class="metric-value" id="fps-value">--</div>
                    <div class="metric-trend" id="fps-trend"></div>
                </div>

                <div class="metric-card">
                    <h3>‚ö° Throughput</h3>
                    <div class="metric-value" id="throughput-value">--</div>
                    <div class="metric-trend" id="throughput-trend"></div>
                </div>

                <div class="metric-card">
                    <h3>üéØ Quality Score</h3>
                    <div class="metric-value" id="quality-value">--</div>
                    <div class="metric-trend" id="quality-trend"></div>
                </div>

                <div class="metric-card">
                    <h3>üíæ Memory Usage</h3>
                    <div class="metric-value" id="memory-value">--</div>
                    <div class="metric-trend" id="memory-trend"></div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <h3>Performance Over Time</h3>
                    <canvas id="performanceChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>Resource Utilization</h3>
                    <canvas id="resourceChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>Quality Metrics</h3>
                    <canvas id="qualityChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>System Load</h3>
                    <canvas id="loadChart"></canvas>
                </div>
            </div>

            <!-- System Health -->
            <div class="system-health">
                <h3>üè• System Health Status</h3>
                <div class="health-grid" id="health-grid">
                    <!-- Health items will be populated by JavaScript -->
                </div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button class="btn" onclick="refreshDashboard()">üîÑ Refresh Data</button>
                <button class="btn" onclick="exportReport()">üìä Export Report</button>
                <button class="btn" onclick="toggleAutoRefresh()">‚è±Ô∏è Auto Refresh</button>
            </div>
        </div>
    </div>

    <script>
        // Dashboard state
        let dashboardData = null;
        let charts = {};
        let autoRefreshInterval = null;
        let isAutoRefresh = false;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
        });

        async function initializeDashboard() {
            try {
                // Simulate loading analytics data
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Generate mock data for demonstration
                dashboardData = generateMockData();
                
                // Hide loading and show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
                
                // Update dashboard
                updateDashboard();
                initializeCharts();
                
            } catch (error) {
                showError('Failed to initialize dashboard: ' + error.message);
            }
        }

        function generateMockData() {
            return {
                session_info: {
                    session_id: "session_20260112_153000",
                    start_time: new Date().toISOString(),
                    uptime_minutes: 145.2
                },
                performance: {
                    fps: { current: 95.5, average: 92.3, min: 85.1, max: 98.7 },
                    throughput: { current: 1.8, average: 1.6, min: 1.2, max: 2.1 },
                    latency: { current: 45.2, average: 48.1, min: 42.0, max: 55.3 },
                    processing_time: { current: 523.1, average: 545.2, min: 480.0, max: 620.0 }
                },
                quality: {
                    ssim_score: { trend: "improving", change: 0.02, current: 0.94 },
                    psnr_score: { trend: "stable", change: 0.1, current: 28.5 },
                    coherence_score: { trend: "improving", change: 0.03, current: 0.92 }
                },
                resources: {
                    cpu_percent: { value: 45.2, unit: "%" },
                    memory_percent: { value: 62.1, unit: "%" },
                    gpu_percent: { value: 78.3, unit: "%" },
                    temperature: { value: 65.0, unit: "¬∞C" }
                },
                system_health: {
                    status: "healthy",
                    error_rate: 2.1,
                    uptime_hours: 24.5,
                    dependencies: {
                        ffmpeg: true,
                        gpu_driver: true,
                        storage: true,
                        network: true
                    }
                }
            };
        }

        function updateDashboard() {
            if (!dashboardData) return;

            // Update key metrics
            updateMetricCard('fps', dashboardData.performance.fps.current, 'FPS', 'improving');
            updateMetricCard('throughput', dashboardData.performance.throughput.current, 'ops/sec', 'stable');
            updateMetricCard('quality', dashboardData.quality.ssim_score.current, 'SSIM', dashboardData.quality.ssim_score.trend);
            updateMetricCard('memory', dashboardData.resources.memory_percent.value, '%', 'stable');

            // Update system health
            updateSystemHealth();
        }

        function updateMetricCard(id, value, unit, trend) {
            const valueElement = document.getElementById(`${id}-value`);
            const trendElement = document.getElementById(`${id}-trend`);

            if (valueElement) {
                valueElement.innerHTML = `${value.toFixed(1)}<span class="metric-unit">${unit}</span>`;
            }

            if (trendElement) {
                const trendClass = `trend-${trend}`;
                const trendArrow = trend === 'improving' ? '‚Üó' : trend === 'declining' ? '‚Üò' : '‚Üí';
                trendElement.innerHTML = `<span class="trend-arrow ${trendClass}">${trendArrow}</span>${trend}`;
            }
        }

        function updateSystemHealth() {
            const healthGrid = document.getElementById('health-grid');
            const health = dashboardData.system_health;

            let healthHTML = `
                <div class="health-item">
                    <span class="status-indicator status-${health.status}"></span>
                    Overall Status: ${health.status.toUpperCase()}
                </div>
                <div class="health-item">
                    <span class="status-indicator status-healthy"></span>
                    Uptime: ${health.uptime_hours.toFixed(1)}h
                </div>
                <div class="health-item">
                    <span class="status-indicator ${health.error_rate > 5 ? 'status-warning' : 'status-healthy'}"></span>
                    Error Rate: ${health.error_rate.toFixed(1)}%
                </div>
            `;

            for (const [dep, status] of Object.entries(health.dependencies)) {
                const statusClass = status ? 'status-healthy' : 'status-critical';
                healthHTML += `
                    <div class="health-item">
                        <span class="status-indicator ${statusClass}"></span>
                        ${dep.toUpperCase()}: ${status ? 'OK' : 'FAILED'}
                    </div>
                `;
            }

            healthGrid.innerHTML = healthHTML;
        }

        function initializeCharts() {
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            charts.performance = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: generateTimeLabels(12),
                    datasets: [{
                        label: 'FPS',
                        data: generateRandomData(12, 85, 98),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Throughput',
                        data: generateRandomData(12, 1.2, 2.1),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Resource Chart
            const resourceCtx = document.getElementById('resourceChart').getContext('2d');
            charts.resource = new Chart(resourceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['CPU', 'Memory', 'GPU', 'Available'],
                    datasets: [{
                        data: [45.2, 62.1, 78.3, 100 - Math.max(45.2, 62.1, 78.3)],
                        backgroundColor: ['#3498db', '#e74c3c', '#f39c12', '#ecf0f1']
                    }]
                },
                options: {
                    responsive: true
                }
            });

            // Quality Chart
            const qualityCtx = document.getElementById('qualityChart').getContext('2d');
            charts.quality = new Chart(qualityCtx, {
                type: 'radar',
                data: {
                    labels: ['SSIM', 'PSNR', 'Coherence', 'Artifacts', 'User Rating'],
                    datasets: [{
                        label: 'Quality Metrics',
                        data: [0.94, 0.85, 0.92, 0.98, 0.90],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });

            // Load Chart
            const loadCtx = document.getElementById('loadChart').getContext('2d');
            charts.load = new Chart(loadCtx, {
                type: 'bar',
                data: {
                    labels: ['Queue Depth', 'Active Workers', 'Pending Jobs', 'Completed'],
                    datasets: [{
                        label: 'System Load',
                        data: [3, 8, 2, 45],
                        backgroundColor: ['#9b59b6', '#34495e', '#f39c12', '#27ae60']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function generateTimeLabels(count) {
            const labels = [];
            const now = new Date();
            for (let i = count - 1; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 5 * 60 * 1000);
                labels.push(time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
            }
            return labels;
        }

        function generateRandomData(count, min, max) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(Math.random() * (max - min) + min);
            }
            return data;
        }

        function refreshDashboard() {
            // Simulate data refresh
            dashboardData = generateMockData();
            updateDashboard();
            
            // Update charts with new data
            Object.values(charts).forEach(chart => {
                if (chart.data.datasets[0].data) {
                    chart.data.datasets.forEach(dataset => {
                        dataset.data = generateRandomData(dataset.data.length, 
                            Math.min(...dataset.data) * 0.9, 
                            Math.max(...dataset.data) * 1.1);
                    });
                    chart.update();
                }
            });
            
            showNotification('Dashboard refreshed successfully!');
        }

        function exportReport() {
            const report = {
                generated_at: new Date().toISOString(),
                dashboard_data: dashboardData,
                export_type: 'analytics_report'
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analytics_report_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Report exported successfully!');
        }

        function toggleAutoRefresh() {
            if (isAutoRefresh) {
                clearInterval(autoRefreshInterval);
                isAutoRefresh = false;
                showNotification('Auto-refresh disabled');
            } else {
                autoRefreshInterval = setInterval(refreshDashboard, 30000); // 30 seconds
                isAutoRefresh = true;
                showNotification('Auto-refresh enabled (30s interval)');
            }
        }

        function showNotification(message) {
            // Simple notification system
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.getElementById('dashboard-container').prepend(errorDiv);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>